CREATE PROCEDURE MixResultDW_Select (
IN v_MixId INTEGER,
IN v_Precision INTEGER
)
MODIFIES SQL DATA DYNAMIC RESULT SETS 1 BEGIN ATOMIC
DECLARE result CURSOR
FOR
SELECT
       MIXID,
       FOODID,
       NAME,
       Weight,
       CompleteProtein,
       IncompleteProtein,
       DigestibleCarbohydrate,
       Cost,
       Protein,
       Fat,
       CarbsByDiff,
       Energy,
       Sucrose,
       Fructose,
       Lactose,
       Alcohol,
       Water,
       Fiber,
       Calcium,
       Iron,
       Magnesium,
       Phosphorus,
       Potassium,
       Sodium,
       Zinc,
       Copper,
       Fluoride,
       Manganese,
       Selenium,
       VitaminA,
       VitaminE,
       VitaminD,
       VitaminC,
       Thiamin,
       Riboflavin,
       Niacin,
       Pantothenic,
       VitaminB6,
       VitaminB12,
       Choline,
       VitaminK,
       Folate,
       Cholesterol,
       Saturated,
       DHA,
       EPA,
       Monounsaturated,
       Polyunsaturated,
       Linoleic,
       AlphaLinolenic
FROM (
SELECT MIXID,
       FOODID,
       NAME,
       Round(Weight,v_Precision) as Weight,
       Round(CompleteProtein,v_Precision) as CompleteProtein,
       Round(IncompleteProtein,v_Precision) as IncompleteProtein,
       Round(DigestibleCarbohydrate,v_Precision) as DigestibleCarbohydrate,
       Round(Cost,v_Precision) as Cost,
       Round(Protein,v_Precision) as Protein,
       Round(Fat,v_Precision) as Fat,
       Round(CarbsByDiff,v_Precision) as CarbsByDiff,
       Round(Energy,v_Precision) as Energy,
       Round(Sucrose,v_Precision) as Sucrose,
       Round(Fructose,v_Precision) as Fructose,
       Round(Lactose,v_Precision) as Lactose,
       Round(Alcohol,v_Precision) as Alcohol,
       Round(Water,v_Precision) as Water,
       Round(Fiber,v_Precision) as Fiber,
       Round(Calcium,v_Precision) as Calcium,
       Round(Iron,v_Precision) as Iron,
       Round(Magnesium,v_Precision) as Magnesium,
       Round(Phosphorus,v_Precision) as Phosphorus,
       Round(Potassium,v_Precision) as Potassium,
       Round(Sodium,v_Precision) as Sodium,
       Round(Zinc,v_Precision) as Zinc,
       Round(Copper,v_Precision) as Copper,
       Round(Fluoride,v_Precision) as Fluoride,
       Round(Manganese,v_Precision) as Manganese,
       Round(Selenium,v_Precision) as Selenium,
       Round(VitaminA,v_Precision) as VitaminA,
       Round(VitaminE,v_Precision) as VitaminE,
       Round(VitaminD,v_Precision) as VitaminD,
       Round(VitaminC,v_Precision) as VitaminC,
       Round(Thiamin,v_Precision) as Thiamin,
       Round(Riboflavin,v_Precision) as Riboflavin,
       Round(Niacin,v_Precision) as Niacin,
       Round(Pantothenic,v_Precision) as Pantothenic,
       Round(VitaminB6,v_Precision) as VitaminB6,
       Round(VitaminB12,v_Precision) as VitaminB12,
       Round(Choline,v_Precision) as Choline,
       Round(VitaminK,v_Precision) as VitaminK,
       Round(Folate,v_Precision) as Folate,
       Round(Cholesterol,v_Precision) as Cholesterol,
       Round(Saturated,v_Precision) as Saturated,
       Round(DHA,v_Precision) as DHA,
       Round(EPA,v_Precision) as EPA,
       Round(Monounsaturated,v_Precision) as Monounsaturated,
       Round(Polyunsaturated,v_Precision) as Polyunsaturated,
       Round(Linoleic,v_Precision) as Linoleic,
       Round(AlphaLinolenic,v_Precision) as AlphaLinolenic
FROM PUBLIC.MIXRESULTDW
WHERE MIXID = v_MixId
UNION
SELECT MIXID,
       '99999',
       'Total',
       Round(Sum(Weight),v_Precision),
       Round(Sum(CompleteProtein),v_Precision),
       Round(Sum(IncompleteProtein),v_Precision),
       Round(Sum(DigestibleCarbohydrate),v_Precision),
       Round(Sum(Cost),v_Precision),
       Round(Sum(Protein),v_Precision),
       Round(Sum(Fat),v_Precision),
       Round(Sum(CarbsByDiff),v_Precision),
       Round(Sum(Energy),v_Precision),
       Round(Sum(Sucrose),v_Precision),
       Round(Sum(Fructose),v_Precision),
       Round(Sum(Lactose),v_Precision),
       Round(Sum(Alcohol),v_Precision),
       Round(Sum(Water),v_Precision),
       Round(Sum(Fiber),v_Precision),
       Round(Sum(Calcium),v_Precision),
       Round(Sum(Iron),v_Precision),
       Round(Sum(Magnesium),v_Precision),
       Round(Sum(Phosphorus),v_Precision),
       Round(Sum(Potassium),v_Precision),
       Round(Sum(Sodium),v_Precision),
       Round(Sum(Zinc),v_Precision),
       Round(Sum(Copper),v_Precision),
       Round(Sum(Fluoride),v_Precision),
       Round(Sum(Manganese),v_Precision),
       Round(Sum(Selenium),v_Precision),
       Round(Sum(VitaminA),v_Precision),
       Round(Sum(VitaminE),v_Precision),
       Round(Sum(VitaminD),v_Precision),
       Round(Sum(VitaminC),v_Precision),
       Round(Sum(Thiamin),v_Precision),
       Round(Sum(Riboflavin),v_Precision),
       Round(Sum(Niacin),v_Precision),
       Round(Sum(Pantothenic),v_Precision),
       Round(Sum(VitaminB6),v_Precision),
       Round(Sum(VitaminB12),v_Precision),
       Round(Sum(Choline),v_Precision),
       Round(Sum(VitaminK),v_Precision),
       Round(Sum(Folate),v_Precision),
       Round(Sum(Cholesterol),v_Precision),
       Round(Sum(Saturated),v_Precision),
       Round(Sum(DHA),v_Precision),
       Round(Sum(EPA),v_Precision),
       Round(Sum(Monounsaturated),v_Precision),
       Round(Sum(Polyunsaturated),v_Precision),
       Round(Sum(Linoleic),v_Precision),
       Round(Sum(AlphaLinolenic),v_Precision)
FROM PUBLIC.MIXRESULTDW
WHERE MIXID = v_MixId
GROUP BY MIXID
)
ORDER BY Energy, Weight;
--
OPEN result;
END;
/